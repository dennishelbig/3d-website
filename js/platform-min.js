var timerId,throttleFunction=function(e,t){timerId||(timerId=setTimeout((function(){e(),timerId=void 0}),t))};function offset(e){var t=e.getBoundingClientRect(),o=window.pageXOffset||document.documentElement.scrollLeft,n=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+n,left:t.left+o}}var tweenMove,tweenCoordsPoint,prevY,$body=document.getElementById("body"),$canvas=document.getElementById("canvas"),$platform=document.getElementById("platform"),$area=document.getElementById("area"),$map=document.getElementById("map"),$mapInner=document.getElementById("inner-map"),$point=document.getElementById("point"),rotateAngleX=0,rotateAngleY=0,moveFired=!1,turnFired=!1,mapRatio=$area.offsetWidth/$map.offsetWidth,$displayDeg=document.getElementById("display-deg").getElementsByTagName("span")[0],$displayX=document.getElementById("display-x-coord").getElementsByTagName("span")[0],$displayY=document.getElementById("display-y-coord").getElementsByTagName("span")[0];function rotateSquareWithDevice(e){rotateAngleY+=e.deltaX/-10,(rotateAngleY=Math.round(100*(rotateAngleY+Number.EPSILON))/100)>=360&&(rotateAngleY-=360),rotateAngleY<=0&&(rotateAngleY+=360),gsap.set($platform,{rotateY:rotateAngleY}),$displayDeg.innerHTML=Math.floor(rotateAngleY)}function rotateSquareWithKeys(e){prevY=rotateAngleY,rotateAngleY+=e,(rotateAngleY=Math.round(100*(rotateAngleY+Number.EPSILON))/100)>=360&&(gsap.set($platform,{rotateY:prevY-360}),rotateAngleY-=360),rotateAngleY<0&&(gsap.set($platform,{rotateY:prevY+360}),rotateAngleY+=360),gsap.to($platform,{ease:Linear.easeNone,rotateY:rotateAngleY,duration:.05,onComplete:function(){!0===turnFired&&rotateSquareWithKeys(e)}}),$displayDeg.innerHTML=Math.floor(rotateAngleY)}function getSrollInput(e){rotateSquareWithDevice(e),event.preventDefault()}$canvas.addEventListener("wheel",getSrollInput,!1);var x=0,y=0,unit=200,duration=.1;function getOffsetX(){var e;return rotateAngleY>=0&&rotateAngleY<90&&(e=rotateAngleY/-90*unit),rotateAngleY>=90&&rotateAngleY<180&&(e=(180-rotateAngleY)/-90*unit),rotateAngleY>=180&&rotateAngleY<270&&(e=(rotateAngleY-180)/90*unit),rotateAngleY>=270&&rotateAngleY<360&&(e=(rotateAngleY-360)/-90*unit),e}function getOffsetY(){var e;return rotateAngleY>=0&&rotateAngleY<90&&(e=unit-rotateAngleY/90*unit),rotateAngleY>=90&&rotateAngleY<180&&(e=(90-rotateAngleY)/90*unit),rotateAngleY>=180&&rotateAngleY<270&&(e=(rotateAngleY-270)/90*unit),rotateAngleY>=270&&rotateAngleY<360&&(e=(270-rotateAngleY)/-90*unit),e}var areaHeight=$area.offsetHeight,areaWidth=$area.offsetWidth;console.log(areaWidth),console.log(areaHeight);var $sections=document.getElementsByTagName("section"),$sectionsNone=document.querySelectorAll("section.none"),$cells=document.getElementsByClassName("cell"),sectionOffset=[];setTimeout((function(){for(var e=$sectionsNone.length-1;e>=0;e--){var t=$sectionsNone[e],o=t.offsetLeft-areaWidth/2,n=o+t.offsetWidth,a=t.parentElement.offsetTop-areaHeight/2,r=a+t.offsetHeight;sectionOffset.push({left:o,right:n,top:a,bottom:r})}console.log(sectionOffset)}),1e3);var wallOffset=100,maxOffset=($platform.offsetWidth-wallOffset)/2;function limitOffset(e,t){for(var o=sectionOffset.length-1;o>=0;o--){var n,a,r=sectionOffset[o],i=r.left-wallOffset,s=r.right+wallOffset,f=r.top-wallOffset,l=r.bottom+wallOffset;if(e>maxOffset&&(e=maxOffset,console.log("a")),e<-1*maxOffset&&(e=-1*maxOffset,console.log("b")),t>maxOffset&&(t=maxOffset,console.log("c")),t<-1*maxOffset&&(t=-1*maxOffset,console.log("d")),e>=i&&e<=s&&t>=f&&t<=l){if(console.log("--------"+o),e>=r.left-wallOffset&&e<=r.left+wallOffset)return[n=i,a=t];if(e>=r.right-wallOffset&&e<=r.right+wallOffset)return n=s,a=t,console.log("%c correction:   x: "+Math.floor(n)+"    y: "+Math.floor(a),"background: #222; color: red"),[n,a];if(t>=r.top-wallOffset&&t<=r.top+wallOffset)return[n=e,a=f];if(t>=r.bottom-wallOffset&&t<=r.bottom+wallOffset)return[n=e,a=l]}}return[e,t]}function getCurrentSection(){document.elementFromPoint(0,0)}function updatePositionMap(){var e=limitOffset(x,y);$displayX.innerHTML=Math.floor(e[0]),$displayY.innerHTML=Math.floor(e[1]),tweenCoordsPoint=gsap.to($point,{duration:duration,ease:Linear.easeNone,x:e[0]/mapRatio*-1,y:e[1]/mapRatio*-1})}function moveForwards(){x+=getOffsetX(),y+=getOffsetY();var e=limitOffset(x,y);x=e[0],y=e[1],updatePositionMap(),tweenMove=gsap.to($area,{ease:Linear.easeNone,duration:duration,y:y,x:x,onComplete:function(){!0===moveFired&&moveForwards()}})}function moveBackwards(){x+=-1*getOffsetX(),y+=-1*getOffsetY();var e=limitOffset(x,y);x=e[0],y=e[1],updatePositionMap(),tweenMove=gsap.to($area,{ease:Linear.easeNone,duration:duration,y:y,x:x,onComplete:function(){!0===moveFired&&moveBackwards()}})}function moveLeft(){x+=getOffsetY(),y+=-1*getOffsetX();var e=limitOffset(x,y);x=e[0],y=e[1],updatePositionMap(),tweenMove=gsap.to($area,{ease:Linear.easeNone,duration:duration,y:y,x:x,onComplete:function(){!0===moveFired&&moveLeft()}})}function moveRight(){x+=-1*getOffsetY(),y+=getOffsetX();var e=limitOffset(x,y);x=e[0],y=e[1],updatePositionMap(),tweenMove=gsap.to($area,{ease:Linear.easeNone,duration:duration,y:y,x:x,onComplete:function(){!0===moveFired&&moveRight()}})}function turnRight(){x+=-1*getOffsetY(),y+=getOffsetX(),x=limitOffset(x),y=limitOffset(y),updatePositionMap(),tweenMove=gsap.to($area,{ease:Linear.easeNone,duration:duration,y:y,x:x,onComplete:function(){!0===moveFired&&moveRight()}})}getCurrentSection();var rotateKey,listener=new window.keypress.Listener;function keyup(){moveFired=!1,console.log("keyup")}var my_scope=this,my_combos=listener.register_many([{keys:"w",on_keydown:function(e){moveFired||(moveFired=!0,throttleFunction(moveForwards,0))},on_keyup:function(e){keyup()},this:my_scope},{keys:"s",on_keydown:function(e){moveFired||(moveFired=!0,throttleFunction(moveBackwards,0))},on_keyup:function(e){keyup()},this:my_scope},{keys:"a",on_keydown:function(e){moveFired||(moveFired=!0,throttleFunction(moveLeft,0))},on_keyup:function(e){keyup()},this:my_scope},{keys:"d",on_keydown:function(e){moveFired||(moveFired=!0,throttleFunction(moveRight,0))},on_keyup:function(e){keyup()},this:my_scope},{keys:"left",on_keydown:function(e){turnFired||(rotateKey="left",turnFired=!0,rotateSquareWithKeys(-5))},on_keyup:function(e){turnFired=!1,console.log("left")},this:my_scope},{keys:"right",on_keydown:function(e){turnFired||(rotateKey="right",turnFired=!0,rotateSquareWithKeys(5))},on_keyup:function(e){turnFired=!1,console.log("right")},this:my_scope},{keys:"space",on_keydown:function(e){console.log("space")},this:my_scope}]);
//# sourceMappingURL=platform-min.js.map